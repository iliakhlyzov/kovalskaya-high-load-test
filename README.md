# Kovalskaya High Load Test

Простое веб-приложение на базе Node.js и PostgreSQL, проверяющее параллельное обновление баланса без возможности ухода в минус. Тестируется отправкой большого количества одновременных запросов (например, 10000).
Также приложение обрабатывает клиентов на **нескольких серверах одновременно** (минимум 5 параллельных копий) и поддерживает **фоновые cron-задачи**

## Запуск через Docker

1. Скопируйте файл `.env.example` в `.env` и заполните нужными значениями (порт, настройки БД и т. д.).
2. Выполните для одного сервера:
   ```bash
   docker-compose build
   docker-compose up
   ```
После сборки приложение станет доступно на порту **3000**.

В случае запуска нескольких серверов выполните следующее:
```bash
docker-compose -f docker-compose-sim.yaml up --build
```

## Краткое описание функционала

1. **Миграции** создают таблицу `userBalance` с полем `balance`, изначально равным 10000. Cоздают таблицу `cron_tasks` и `cron_task_logs` и добавляют 10 работ. 
2. **PUT `/user-balance/:id`** — эндпоинт для изменения баланса (принимает `delta`). Если новое значение уходит в минус, возвращается ошибка (статус 400).
3. **Высоконагрузочный тест**: отправка 10000 одновременных запросов по уменьшению баланса на 2 единицы. Ожидается, что 5000 запросов пройдут успешно (баланс дойдёт до 0), а остальные получат ошибку о недостатке средств.
4. **GET /cron** — эндпоинт для получения списка всех фоновых задач, их текущего статуса, сервера, на котором они выполняются, и времени последнего выполнения. Также возвращает ожидающие выполнения задачи и последний лог, связанный с завершением каждой из них.

Запуск приложения через Docker обеспечивает автоматическое создание/применение миграций (при старте), что упрощает развёртывание и тестирование.



